# Uncomment these two lines to enable debug logging
# DbgDefines = -DDEBUG
# DbgObjects = @.o.syslog

# Other options
Defines = $(DbgDefines)

# Toolflags:
CCflags = -c -depend !Depend -IC:,@.TCPIPLibs.headers -throwback -zM -w -strict -fach -Otime $(Defines)
Linkflags = -m -o $@ 
ObjAsmflags = -depend !Depend -Stamp -quit -CloseExec -throwback
LibFileflags = -c -o $@
Squeezeflags = -o $@

Objects = 	@.o.ModuleHdr \
		@.o.module \
		@.o.if_enc \
		@.o.filter \
		@.o.errors \
		@.o.mbuf \
		@.o.commands \
		@.o.glue \
		@.o.iocopy

# Uncomment this line to generate generate assembled versions of C source.
# CCasm =	cc $(CCflags) -s -o @.c_s.$* @.c.$*

all: @.EtherENC @.ENCRom $(asm)

clean:
	-Wipe @.o.* ~c
	-Wipe @.c_s.* ~c
	-Wipe @.h.ModuleHdr ~c
	-Wipe @.EtherENC ~c
	-Wipe @.ENCRom ~c

# Final targets:
@.EtherENC: $(Objects) $(DbgObjects) C:o.Stubs 
	Link $(Linkflags) $(Objects) $(DbgObjects) C:o.Stubs

@.ENCRom: @.MkROM @.EtherENC
	Run @.MkROM

o.if_enc: h.ModuleHdr
o.commands: h.ModuleHdr

.SUFFIXES: .o .h .c .s .cmhg .c_s

.c.o: o.ModuleHdr
	cc $(CCflags) -o $@ @.c.$*
	$(CCasm)

.s.o:
	ObjAsm $(ObjAsmflags) -o $@ @.s.$*

.cmhg.h .cmhg.o:
	cmhg @.cmhg.$* @.o.$* @.h.$*
